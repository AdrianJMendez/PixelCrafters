

const Empresas = [
    {
        "categoria": "Ropa",
        "nombre": "Broks Brothers",
        "imagen": "/public/assets/Imagenes/Empresa2.png",
        "productos": [
          {
            "precio": 50,
            "unidades_disponibles": 100,
            "unidades_vendidas": 30,
            "id_producto": "BB001",
            "nombre_producto": "Camisa de vestir",
            "descripcion": "Camisa de vestir para caballero",
            "imagen_producto": "/public/assets/Imagenes/1.jpg"
          },
          {
            "precio": 60,
            "unidades_disponibles": 80,
            "unidades_vendidas": 20,
            "id_producto": "BB002",
            "nombre_producto": "Pantalón",
            "descripcion": "Pantalón formal para caballero",
            "imagen_producto": "/public/assets/Imagenes/2.jpg"
          },
          {
            "precio": 70,
            "unidades_disponibles": 120,
            "unidades_vendidas": 50,
            "id_producto": "BB003",
            "nombre_producto": "Vestido",
            "descripcion": "Vestido elegante para dama",
            "imagen_producto": "/public/assets/Imagenes/3.jpg"
          }
        ]
      },

      {
        "categoria": "Ropa",
        "nombre": "Ralph Lauren",
        "imagen": "/public/assets/Imagenes/Empresa8.png",
        "productos": [
          {
            "precio": 80,
            "unidades_disponibles": 80,
            "unidades_vendidas": 50,
            "id_producto": "RL001",
            "nombre_producto": "Polo",
            "descripcion": "Polo de algodón para hombre",
            "imagen_producto": "/public/assets/Imagenes/12.jpg"
          },
          {
            "precio": 90,
            "unidades_disponibles": 60,
            "unidades_vendidas": 40,
            "id_producto": "RL002",
            "nombre_producto": "Chamarra",
            "descripcion": "Chamarra de cuero para hombre",
            "imagen_producto": "/public/assets/Imagenes/32.jpg"
          },
          {
            "precio": 100,
            "unidades_disponibles": 100,
            "unidades_vendidas": 30,
            "id_producto": "RL003",
            "nombre_producto": "Vestido",
            "descripcion": "Vestido de noche para mujer",
            "imagen_producto": "/public/assets/Imagenes/4.jpg"
          }
        ]
      },
      
      {
        "categoria": "Ropa",
        "nombre": "Hugo Boss",
        "imagen": "/public/assets/Imagenes/Empresa1.png",
        "productos": [
          {
            "precio": 120,
            "unidades_disponibles": 60,
            "unidades_vendidas": 20,
            "id_producto": "HB001",
            "nombre_producto": "Traje",
            "descripcion": "Traje de negocios para hombre",
            "imagen_producto": "/public/assets/Imagenes/7.jpg"
          },
          {
            "precio": 130,
            "unidades_disponibles": 40,
            "unidades_vendidas": 15,
            "id_producto": "HB002",
            "nombre_producto": "Corbata",
            "descripcion": "Corbata de seda para hombre",
            "imagen_producto": "/public/assets/Imagenes/22.jpg"
          },
          {
            "precio": 110,
            "unidades_disponibles": 80,
            "unidades_vendidas": 30,
            "id_producto": "HB003",
            "nombre_producto": "Blusa",
            "descripcion": "Blusa elegante para mujer",
            "imagen_producto": "/public/assets/Imagenes/26.jpg"
          }
        ]
      },

      {
        "categoria": "Ropa",
        "nombre": "J Crew",
        "imagen": "/public/assets/Imagenes/Empresa4.png",
        "productos": [
          {
            "precio": 60,
            "unidades_disponibles": 70,
            "unidades_vendidas": 25,
            "id_producto": "JC001",
            "nombre_producto": "Saco",
            "descripcion": "Saco de lana para hombre",
            "imagen_producto": "/public/assets/Imagenes/32.jpg"
          },
          {
            "precio": 50,
            "unidades_disponibles": 90,
            "unidades_vendidas": 40,
            "id_producto": "JC002",
            "nombre_producto": "Camisa",
            "descripcion": "Camisa casual para hombre",
            "imagen_producto": "/public/assets/Imagenes/6.jpg"
          },
          {
            "precio": 70,
            "unidades_disponibles": 50,
            "unidades_vendidas": 10,
            "id_producto": "JC003",
            "nombre_producto": "Falda",
            "descripcion": "Falda a la rodilla para mujer",
            "imagen_producto": "/public/assets/Imagenes/16.jpg"
          }
        ]
      },

      {
        "categoria": "Ropa",
        "nombre": "Nike",
        "imagen": "/public/assets/Imagenes/Empresa10.png",
        "productos": [
          {
            "precio": 90,
            "unidades_disponibles": 100,
            "unidades_vendidas": 60,
            "id_producto": "NK001",
            "nombre_producto": "Tenis",
            "descripcion": "Tenis deportivos para hombre",
            "imagen_producto": "/public/assets/Imagenes/10.jpg"
          },
          {
            "precio": 80,
            "unidades_disponibles": 80,
            "unidades_vendidas": 35,
            "id_producto": "NK002",
            "nombre_producto": "Playera",
            "descripcion": "Playera de manga corta para mujer",
            "imagen_producto": "/public/assets/Imagenes/11.jpg"
          },
          {
            "precio": 100,
            "unidades_disponibles": 120,
            "unidades_vendidas": 70,
            "id_producto": "NK003",
            "nombre_producto": "Shorts",
            "descripcion": "Shorts deportivos para hombre",
            "imagen_producto": "/public/assets/Imagenes/24.jpg"
          }
        ]
      },
      
      {
        "categoria": "Productos_Varios",
        "nombre": "Urban Outfitters",
        "imagen": "/public/assets/Imagenes/Empresa5.png",
        "productos": [
          {
            "precio": 15,
            "unidades_disponibles": 200,
            "unidades_vendidas": 100,
            "id_producto": "UO001",
            "nombre_producto": "posters",
            "descripcion": "Poster decorativo",
            "imagen_producto": "/public/assets/Imagenes/31.jpg"
          },
          {
            "precio": 10,
            "unidades_disponibles": 150,
            "unidades_vendidas": 70,
            "id_producto": "UO002",
            "nombre_producto": "tazas",
            "descripcion": "Taza con diseño",
            "imagen_producto": "/public/assets/Imagenes/33.jpg"
          },
          {
            "precio": 5,
            "unidades_disponibles": 300,
            "unidades_vendidas": 150,
            "id_producto": "UO003",
            "nombre_producto": "tarjetas",
            "descripcion": "Tarjetas de felicitación",
            "imagen_producto": "/public/assets/Imagenes/38.jpg"
          }
        ]
      },

      {
        "categoria": "Productos_Varios",
        "nombre": "Target",
        "imagen": "/public/assets/Imagenes/Empresa6.png",
        "productos": [
          {
            "precio": 25,
            "unidades_disponibles": 300,
            "unidades_vendidas": 120,
            "id_producto": "TG001",
            "nombre_producto": "tazas",
            "descripcion": "Taza con estampados únicos",
            "imagen_producto": "/public/assets/Imagenes/39.jpg"
          },
          {
            "precio": 15,
            "unidades_disponibles": 500,
            "unidades_vendidas": 200,
            "id_producto": "TG002",
            "nombre_producto": "tazas",
            "descripcion": "Botella reutilizable",
            "imagen_producto": "/public/assets/Imagenes/35.jpg"
          },
          {
            "precio": 20,
            "unidades_disponibles": 200,
            "unidades_vendidas": 100,
            "id_producto": "TG003",
            "nombre_producto": "tarjetas",
            "descripcion": "Tarjeta decorativo",
            "imagen_producto": "/public/assets/Imagenes/36.jpg"
          }
        ]
      },

      {
        "categoria": "Productos_Varios",
        "nombre": "Staples",
        "imagen": "/public/assets/Imagenes/Empresa7.png",
        "productos": [
          {
            "precio": 8,
            "unidades_disponibles": 500,
            "unidades_vendidas": 300,
            "id_producto": "SP001",
            "nombre_producto": "libretas",
            "descripcion": "Libretas con espiral",
            "imagen_producto": "/public/assets/Imagenes/38.jpg"
          },
          {
            "precio": 5,
            "unidades_disponibles": 800,
            "unidades_vendidas": 400,
            "id_producto": "SP002",
            "nombre_producto": "Bolígrafos",
            "descripcion": "Bolígrafos de tinta gel",
            "imagen_producto": "/public/assets/Imagenes/28.jpg"
          },
          {
            "precio": 15,
            "unidades_disponibles": 200,
            "unidades_vendidas": 100,
            "id_producto": "SP003",
            "nombre_producto": "libretas",
            "descripcion": "Kibreta multifuncional",
            "imagen_producto": "/public/assets/Imagenes/27.jpg"
          }
        ]
      },

      {
        "categoria": "Productos_Varios",
        "nombre": "Office Depot",
        "imagen": "/public/assets/Imagenes/Empresa9.png",
        "productos": [
          {
            "precio": 12,
            "unidades_disponibles": 300,
            "unidades_vendidas": 150,
            "id_producto": "OD001",
            "nombre_producto": "libretas",
            "descripcion": "Agendas con diseños",
            "imagen_producto": "/public/assets/Imagenes/27.jpg"
          },
          {
            "precio": 6,
            "unidades_disponibles": 500,
            "unidades_vendidas": 200,
            "id_producto": "OD002",
            "nombre_producto": "lápices",
            "descripcion": "Lápices de colores",
            "imagen_producto": "/public/assets/Imagenes/17.jpg"
          },
          {
            "precio": 25,
            "unidades_disponibles": 100,
            "unidades_vendidas": 50,
            "id_producto": "OD003",
            "nombre_producto": "posters",
            "descripcion": "Posters de Animaciones",
            "imagen_producto": "/public/assets/Imagenes/18.jpg"
          }
        ]
      },
      
      {
        "categoria": "Productos_Varios",
        "nombre": "Walmart",
        "imagen": "/public/assets/Imagenes/Empresa3.png",
        "productos": [
          {
            "precio": 20,
            "unidades_disponibles": 400,
            "unidades_vendidas": 250,
            "id_producto": "WM001",
            "nombre_producto": "posters",
            "descripcion": "Posters de fútbol",
            "imagen_producto": "/public/assets/Imagenes/15.jpg"
          },
          {
            "precio": 30,
            "unidades_disponibles": 150,
            "unidades_vendidas": 80,
            "id_producto": "WM002",
            "nombre_producto": "libretas",
            "descripcion": "Agendas con diseños",
            "imagen_producto": "/public/assets/Imagenes/13.jpg"
          },

        ]
      }    
];

//funciones de funcionamiento del sitio
function landing(){
  //ocultando los elementos innecesarios
  document.getElementById('Categorias').style.display="block";
  document.getElementById('info_landing').style.display="flex";
  document.getElementById('carrusel').style.display="block";
  //mostrar elementos
  document.getElementById('empresas').style.display="none"
  document.getElementById('productos').style.display="none";
  document.getElementById('paginaP').style.display="none";
  document.getElementById('carrito').style.display="none"
  document.querySelector('header').innerHTML=`<img src="/public/assets/Imagenes/Logo (3).png" onclick="landing()"> 
  <h3 onclick="landing()">Pixel Crafters</h3>
  <i class="fa-solid fa-bars fa-2xl" style="color: #ffffff;"></i>`;
};

function abrirEmpresas(categoria){
  //ocultando los elementos innecesarios
  document.getElementById('Categorias').style.display="none";
  document.getElementById('info_landing').style.display="none";
  document.getElementById('carrusel').style.display="none";
  document.getElementById('productos').style.display="none";
  document.getElementById('paginaP').style.display="none";
  document.getElementById('carrito').style.display="none"
  //mostrar elementos
  document.getElementById('empresas').style.display="flex"
  generarEmpresas(categoria);
};


function abrirPersonalizacion(){
  //ocultando los elementos innecesarios
  document.getElementById('Categorias').style.display="none";
  document.getElementById('info_landing').style.display="none";
  document.getElementById('carrusel').style.display="none";
  document.getElementById('productos').style.display="none";
  document.getElementById('empresas').style.display="none";
  document.getElementById('carrito').style.display="none"
  //mostrar elementos
  document.getElementById('paginaP').style.display="flex"

};


function abrirCarrito(){
  //ocultando los elementos innecesarios
  document.getElementById('Categorias').style.display="none";
  document.getElementById('info_landing').style.display="none";
  document.getElementById('carrusel').style.display="none";
  document.getElementById('productos').style.display="none";
  document.getElementById('empresas').style.display="none";
  document.getElementById('paginaP').style.display="none"
  //mostrar elementos
  document.getElementById('carrito').style.display="flex"

  renderizarCarrito();
};

//funciones de logica del sitio

function generarEmpresas(categoria){

  //cambiamos el header
  document.querySelector('header').innerHTML=`<img src="/public/assets/Imagenes/Logo (3).png" onclick="landing()"> 
  <h3 onclick="landing()">Pixel Crafters</h3>
  <i class="fa-sharp fa-solid fa-cart-shopping fa-2xl" style="color: #fafafa;" onclick="abrirCarrito()"></i>`;
  //limpiamos el contenido
  document.getElementById('empresas').innerHTML='';

  fetch('http://localhost:3000/empresas')
  .then(response => response.json())
  .then(data => {
    if (data.status) {
      const empresas = data.empresas;  
      const opcionesHTML = empresas.map(empresa => {
        if (empresa.categoria === categoria) {
          // Si coincide, la renderizamos
          document.getElementById('empresas').innerHTML+=`<div class="caratulas" onclick="generarProductos('${empresa._id}')">
         <img src="${empresa.imagen}" alt="">
         </div>`;
        }
      });


    } else {
      console.log('No se encontraron empresas:', data.message);
    }
  })
  .catch(error => {
    console.error('Error en la solicitud:', error);
  });

  
};

function generarProductos(id){
  //ocultando los elementos innecesarios
  document.getElementById('empresas').style.display="none";
  //mostrar productos
  document.getElementById('productos').style.display="flex";

  document.getElementById('productos').innerHTML='';

  fetch(`http://localhost:3000/empresas/${id}`).then(response => response.json())
  .then(data => {
    if (data.status) {
      const empresa = data.empresa; 
      const productos = empresa.productos 
      const opcionesHTML = productos.map(producto => {
        document.getElementById('productos').innerHTML+=`  <div class="productosimg">
    <img src="${producto.imagen_producto}" alt="" > 
  </div>
  <div class="dropdown-center">
    <button class="btn-detalles dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" onclick="productoActual('${producto._id}')">
      Detalles
    </button>
    <ul class="dropdown-menu menu-compras">
      <div class="centered-content">
        <h7>${producto.nombre_producto}</h7><br>
        <h10>${producto.descripcion}</h10><br>
       <button class="btn_p" onclick="guardarEnCarrito()">GUARDAR</button>
       <button class="btn_p" onclick="abrirPersonalizacion()" >PERSONALIZAR</button>
      </div>
    </ul>
  </div>`;
      });

    } else {
      console.log('No se encontraron productos:', data.message);
    }
  });
  
 
};

function productoActual(id) {
  fetch(`http://localhost:3000/productos/${id}`).then(response => response.json())
  .then(data => {
    if (data.status) {
      const producto = JSON.stringify(data.producto);
      localStorage.setItem("producto", producto); 
    } else {
      console.log('No se encontraron productos:', data.message);
    }
  });
}

async function guardarEnCarrito(){

const usuarioJSON = localStorage.getItem("usuario");
const usuario = JSON.parse(usuarioJSON);
console.log(usuario._id)

const productoJSON = localStorage.getItem("producto");
const producto = JSON.parse(productoJSON);

const payload = {
  _id:producto._id,
  precio:producto.precio,
  nombre_producto:producto.nombre_producto,
  descripcion:producto.descripcion,
  imagen_producto:producto.imagen_producto
}

const result = await fetch(`http://localhost:3000/usuarios/${usuario._id}`, {
  headers: {'Content-type': 'application/json'},
  body: JSON.stringify(payload),
  method: 'POST'
});
const response = await result.json();
if (!response || !response.status) {
  alert("fallo al agregar producto");
} else {
  alert("Nuevo producto agregado al carrito");
}
console.log(response);

}


function renderizarCarrito(){
  document.getElementById('carritocp').innerHTML=``;
  const usuarioJSON = localStorage.getItem("usuario");
  const usuario = JSON.parse(usuarioJSON);
  fetch(`http://localhost:3000/usuarios/${usuario._id}`).then(response => response.json())
  .then(data => {
    if (data.status) {
      const usuario = data.usuario; 
      const metodoPago = usuario.metodo_de_pagos;
      const carrito = usuario.carrito_de_productos;
      localStorage.setItem('carrito', JSON.stringify(carrito))
      const opcionesHTML = carrito.map(producto => {
        document.getElementById('carritocp').innerHTML+=`
        <div class="nvoPedido">
              <div> <img src="${producto.imagen_producto}" alt=""></div>
              <div>
                  <h6>Nombre: ${producto.nombre_producto}</h6>
                  <h6>Cantidad: (1)</h6>
                  <h6>Monto total: 1*(${producto.precio}Lps.)</h6>
                  <h6>Metodo de pago: ${metodoPago}</h6>
              </div>
            </div><br>
        `;
      });


     
    } else {
      console.log('No se encontraron productos:', data.message);
    }
  });

}

async function pagar(){
  console.log('pago iniciado')
  const carritoJSON = localStorage.getItem("carrito");
  const carrito = JSON.parse(carritoJSON);

  const usuarioJSON = localStorage.getItem("usuario");
  const usuario = JSON.parse(usuarioJSON);

  
    const payload = {
      productos: carrito,
      _id: usuario._id,

    }
    console.log("Login", payload);
    const result = await fetch('http://localhost:3000/ordenes/add', {
      headers: {'Content-type': 'application/json'},
      body: JSON.stringify(payload),
      method: 'POST'
    });
    const response = await result.json();
    if (!response || !response.status) {
      alert("fallo al crear nueva orden");
    } else {
      alert("nueva orden creada");
    }
    console.log(response);
  


}

function generarotros(otro) {
  if (otro != null) {
    // Ocultar los elementos innecesarios
    document.getElementById('Categorias').style.display = "none";
    document.getElementById('info_landing').style.display = "none";
    document.getElementById('carrusel').style.display = "none";
    document.getElementById('empresas').style.display = "none";
    document.getElementById('paginaP').style.display = "none";
    document.getElementById('carrito').style.display = "none";

    // Mostrar elementos
    document.getElementById('productos').style.display = "flex";

    fetch(`http://localhost:3000/productos`)
      .then(response => response.json())
      .then(data => {
        if (data.status) {
          const productos = data.productos;
          const opcionesHTML = productos.map(producto => {
            if (otro <= producto.unidades_vendidas) {
              console.log(producto.unidades_vendidas);
              document.getElementById('productos').innerHTML += `<div class="productosimg">
              <img src="${producto.imagen_producto}" alt=""> 
            </div>
            <div class="dropdown-center">
              <button class="btn-detalles dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" onclick="productoActual('${producto._id}')">
                Detalles
              </button>
              <ul class="dropdown-menu menu-compras">
                <div class="centered-content">
                  <h7>${producto.nombre_producto}</h7><br>
                  <h10>${producto.descripcion}</h10><br>
                  <button class="btn_p" onclick="guardarEnCarrito()">GUARDAR</button>
                  <button class="btn_p" onclick="abrirPersonalizacion()">PERSONALIZAR</button>
                </div>
              </ul>
            </div>`;
            }
          });
        } else {
          console.log('No se encontraron productos:', data.message);
        }
      });
  } else {
    alert('No hay productos');
  }
}
